<!-- PayPal Button -->
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
">
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
<br>

<?php

echo "This database is automatically updated every hour on the half hour";
echo " Eastern)";
echo "<br>";
echo "Wait a few minutes after these times to ensure that the database has";
echo " been fully populated before making a query.";
echo "<br>";
echo "<br>";
echo "To use this, append \"?query=\" to the url followed by your sql query";
echo "<br>";
echo "Example \"stmhall.ca/pickapart.php?query=select * from lot";
echo "<br>";
echo "<br>";
echo "<strong>\"%\"</strong> is now <strong>\"%25\"</strong>. This is because";
echo " URLs use the \"%\" sign to denote special characters, and it so happens";
echo " that \"%25\" is the code for a \"%\" sign";
echo "<br>";
echo "<br>";
echo "The tables to  query from are \"cars\", \"pics\", and \"lot\"";
echo "<br>";
echo "For example, the default query is:";
echo "<br>";
echo "SELECT * FROM lot ORDER BY make, model, year desc";
echo "<br>";

/* Login for the default user of the database. */
/* This just authenticates database users. Since this is a public facing */
/* database, everyone uses this user so no big deal about leaving this here */
/* Especially because this user only has access to select statements anyways */
$username = "stmhallc_user";
$password = "04otmJr2K";
$db = "stmhallc_cars";
$servername = "localhost";

$con=mysqli_connect($servername, $username, $password, $db);
// Check connection
if (mysqli_connect_errno()) {
  echo "Failed to connect to MySQL: " . mysqli_connect_error();
  }


$query = $_GET['query'];

/* Default query */
if ($query == '') {
    $query = "select * from lot order by make, model, year desc";
}

echo "<br>";
echo "Your Query: <strong>$query</strong>";

$result = mysqli_query($con,$query);

$num_rows = mysqli_num_rows($result);

echo "<br>";
if ($num_rows != false) {
  echo "Which resulted in <strong>$num_rows</strong> rows.";
echo "<br>";
  echo "<a href=\"pickapart_table.php?query=$query\">Table</a>";
  echo "&nbsp;&nbsp;&nbsp;";
  echo "<a href=\"pickapart_json.php?query=$query\">JSON</a>";
  echo "&nbsp;&nbsp;&nbsp;";
  echo "<a href=\"pickapart_csv.php?query=$query\">CSV</a>";
}
else {
  echo "Query <strong>Failed</strong>";
}


/* Need to get the names of the headings */
/* If we are looking for * then we don't care */
/* Make the query lowercase for easier parsing */
$mystring = strtolower($query);
if (strpos($mystring, " * ") == false) {
  /* Remove everything after "from" */
  $mystring = explode(" from", $mystring);
  /* Remove "select" */
  $mystring = explode("select", $mystring[0]);

  $mystring = $mystring[1];
  /* split by commas, if they exist */
  if (strpos($mystring, ",") != false) {
      $mystring = explode(",", $mystring);
  }


  /* We now have an array of each element being selected. Just need to check */
  /* if they have the "as" keyword */
  for ($i=0; $i<count($mystring); $i++) {
    /* split by commas, if they exist */
    if (count($mystring) == 1) {
      if (strpos($mystring, "as") != false) {
        $mystring = explode("as ", $mystring);
        $mystring = $mystring[1];
      }
    }
    else {
      if (strpos($mystring[$i], "as") != false) {
        $mystring[$i] = explode("as ", $mystring[$i]);
        $mystring[$i] = $mystring[$i][1];
      }
    }
  }
}
else {
  $mystring = array("urls", "date_added", "make", "model", "year",
                    "body_style", "engine", "transmission", "description",
                    "row", "stock");

}


echo "<table border='1'><tr>";
for ($i=0; $i<count($mystring); $i++) {
  if (count($mystring) == 1) {
    $label = $mystring;
  }
  else {
    $label = $mystring[$i];
  }
  $label = str_replace (' ', '', $label);
  echo "<th>$label</th>";
}
echo "</tr>";

while ($row    = mysqli_fetch_assoc($result)) {
  echo "<tr>";
  for ($i=0; $i<count($mystring); $i++) {
    if (count($mystring) == 1) {
      $label = $mystring;
    }
    else {
      $label = $mystring[$i];
    }
    $label = str_replace (' ', '', $label);
    echo "<td>" . $row[$label] . "</td>";
  }
  echo "</tr>";
}
echo "</table>";

mysqli_close($con);



?>
